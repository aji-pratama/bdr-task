{% extends "base/main_base.html" %}
{% load crispy_forms_tags %}
{% load static %}

<div class="col-md-12 col-sm-12 col-xs-12">
{% block content %}
<div class="x_panel">

    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-success alert-sm">{{ message }}, kembali ke <a href="{% url 'opreport:index_cashadv' %}">Cash Advance List</a></div>
      {% endfor %}
    {% endif %}

    <div class="x_title">
      <h2> Edit Cash Advance {{ cashadv.date_request }}</h2>
      <ul class="nav navbar-right panel_toolbox">
        <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a>
        </li>
      </ul>
      <div class="clearfix"></div>
    </div>

    <div class="x_content">
        {% crispy form %}
    </div>
  </div>
</div>
</div>
<script src="{% static '/vendors/jquery/dist/jquery.min.js' %}"></script>
<script type="text/javascript" src="{% static '/js/jquery-ui.js' %}"></script>
<script type="text/javascript">
$( function() {
  $( "#id_date_request" ).datepicker({
    dateFormat: "yy-mm-dd"
  });
});
  document.getElementById('id_date_request').value = '{{ cashadv.date_request|date:"Y-m-d" }}';
  document.getElementById('id_om').value = '{{ cashadv.om }}';
  document.getElementById('id_name_of_payee').value = '{{ cashadv.name_of_payee }}';
  document.getElementById('id_customer').value = '{{ cashadv.customer }}';
  document.getElementById('id_id_jobno').value = '{{ cashadv.id_jobno }}';
  document.getElementById('id_purpose').value = '{{ cashadv.purpose }}';
  document.getElementById('id_car').value = '{{ cashadv.car }}';
  document.getElementById('id_pi').value = '{{ cashadv.pi }}';
  document.getElementById('id_actual_cost').value = '{{ cashadv.actual_cost }}';
  document.getElementById('id_receive_payment').value = '{{ cashadv.receive_payment }}';
  document.getElementById('id_status').value = '{{  cashadv.status}}';

</script>
{% endblock %}

{% block 'javascript' %}
<script type="text/javascript">
  $(document).ready(function() {
    $(document).on('submit','#id_cashadv_form', function(e){
      e.preventDefault();

      $.ajax({
        type: 'POST',
        url: '{% url "opreport:edit_cashadv" %}',
        data: {

          date_request: $('#id_date_request').val(),
          om: $('#id_om').val(),
          name_of_payee: $('#id_name_of_payee').val(),
          customer: $('#id_customer').val(),
          id_jobno: $('#id_id_jobno').val(),
          purpose: $('#id_purpose').val(),
          car: $('#id_car').val(),
          pi: $('#id_pi').val(),
          actual_cost: $('#id_actual_cost').val(),
          receive_payment: $('#id_receive_payment').val(),
          status: $('#id_status').val(),

          csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        },


        success:function(data){
          $('#myModal').modal('hide');
          location.reload();
        }

      });

    });
  });
</script>

{% endblock %}
